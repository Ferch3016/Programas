#!/bin/bash

# Check if there are cmd line args. There should be at least one
# specifying the website you want pentest
if [ $# -eq 0 ]; then
	echo "You need to specify a website!"
	echo "The syntax is:"
	echo "./pentest.sh <website>"
	exit 1
fi

website=$1

# This function checks if the website you just took in is an ip address or not
is_ip() {
	ip_format="^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$"

	if [[ $1 =~ $ip_format ]]; then
		return 0
	else
		return 1
	fi
}


if is_ip "$website"; then
	echo "The command-line argument you input was a website"
else
	echo "The command-line arument you input was an ip address"
fi

echo "First we'll try pinging the website"
echo "Hit Ctrl+C once you're satisfied with the ping"
echo "--------------------------------------------------------------------"
echo
echo "***Pinging***"
ping -c 10 $website
echo "--------------------------------------------------------------------"
echo
echo "Great! Once that's done we'll get the ip of the domain using nslookup"
echo "***Using nslookup***"
nslookup -type=NS $website > "${website}_nslookup.txt"
dig NS $website >> "${website}_nslookup.txt"
echo "Saved result of nslookup to ${website}_nslookup.txt"
echo "--------------------------------------------------------------------"
echo
echo "Now we're going to see the route we took the the website"
echo "***Using traceroute***"
traceroute $website > "${website}_traceroute.txt"
echo "Saved result of traceroute to ${website}_traceroute.txt"
echo "--------------------------------------------------------------------"
echo
echo "Running whois command"

# The "-H" option hides legal disclaimers "
# Long story short you can't use this information for nefarious puposes
whois -H ${website} > "${website}_whois.txt"
echo "Saved whois into ${website}_whois.txt"
echo "--------------------------------------------------------------------"
echo "Please wait 20 seconds".
echo "Google blocks our commmands when we run too many at once"
sleep 20
echo
echo "Running sublist3r"
sublist3r -d ${website} -o "${website}_sublist3r.txt" 
echo "Saved sublist3r into ${website}_sublist3r.txt"
echo "-------------------------------------------------------------------"
echo
echo "Looking for DNS information of ${website}"
dnsrecon -d "${website}" -t brt > "${website}_dnsrecon.txt" 
echo "Saved dnsrecon into ${website}_dnsrecon.txt"
echo "--------------------------------------------------------------------"
echo
echo "scanning ports in ${website}"
nmap -Pn -sV -T4 "${website}" -oN "${website}_nmap.txt" 
echo "Saved nmap into ${website}_nmap.txt"
echo "--------------------------------------------------------------------"
echo
echo "Finding subdomains of ${website} using dnsmap"
dnsmap "${website}" -r "${website}_dnsmap.txt" 
echo "Saved subdomains into ${website}_dnsmap.txt"
echo "--------------------------------------------------------------------"
echo 
echo "Finding subdomains of ${website} using findomain"
findomain -q -t "${website}" -o "${website}_findomain.txt"
echo "Saved subdomains into ${website}_findomain.txt"
echo "--------------------------------------------------------------------"
echo
echo "Finding subdomains of ${website} using subfinder"
subfinder -d "${website}"  -o "${website}_subfinder.txt"
echo "Saved subdomains into ${website}_subfinder.txt"
echo "--------------------------------------------------------------------"
echo
echo "Running EtherApe"
echo "Note: This process opens up another window"
sudo etherape -f "host ${website}"
cat ${website}_* > "${website}_final.txt"
echo "Saved resutls of all files inside ${website}_final.txt"
exit 0

